<!DOCTYPE html>
<html lang="en">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<!-- Meta, title, CSS, favicons, etc. -->
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<title>游戏数据管理系统</title>

		<!-- Bootstrap -->
		<link href="./vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
		<!-- Font Awesome -->
		<link href="./vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
		<!-- NProgress -->
		<link href="./vendors/nprogress/nprogress.css" rel="stylesheet">
		<!-- bootstrap-daterangepicker -->
        <link href="./vendors/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">
		<!-- Custom Theme Style -->
		<link href="./build/css/custom.min.css" rel="stylesheet">		
		<!-- Datatables -->
	    <link href="./vendors/datatables.net-bs/css/dataTables.bootstrap.min.css" rel="stylesheet">
	    <link href="./vendors/datatables.net-buttons-bs/css/buttons.bootstrap.min.css" rel="stylesheet">
		<style>
			tr{
				cursor: pointer;
			}
		</style>

	</head>

	<body class="nav-md">
		<div class="container body">
			<div class="main_container">
				<div class="col-md-3 left_col">
					<div class="left_col scroll-view">
						<div class="navbar nav_title" style="border: 0;">
							<a href="index.html" class="site_title"><span>管理系统</span></a>
						</div>

						<div class="clearfix"></div>

						<!-- menu profile quick info -->
						<div class="profile">
							<div class="profile_pic">
								<img src="img/a.png" alt="..." class="img-circle profile_img">
							</div>
							<div class="profile_info">
								<span>欢迎,管理员</span>
								<h2 id="username"></h2>
							</div>
						</div>
						<!-- /menu profile quick info -->

						<br />

						<!-- sidebar menu -->
						<div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
							<div class="menu_section">
								<h3>您的头像</h3>
								<ul class="nav side-menu">
									
								</ul>
							</div>

						</div>
						<!-- /sidebar menu -->
					</div>
				</div>

				<!-- top navigation -->
				<div class="top_nav">
					<div class="nav_menu">
						<nav>
							<div class="nav toggle">
								<a id="menu_toggle"><i class="fa fa-bars"></i></a>
							</div>

							<ul class="nav navbar-nav navbar-right">
								<li class="">
									<a href="javascript:;" class="user-profile dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
										<img src="img/a.png" alt="">操作
										<span class=" fa fa-angle-down"></span>
									</a>
									<ul class="dropdown-menu dropdown-usermenu pull-right">
										<li>
											<a href="javascript:;">帮助</a>
										</li>
										<li>
											<a href="login.html"><i class="fa fa-sign-out pull-right"></i> 登出</a>
										</li>
									</ul>
								</li>
							</ul>
						</nav>
					</div>
				</div>
				<!-- /top navigation -->

				<!-- page content -->
				<div class="right_col" role="main">
					<div class="">
						<div class="page-title">
							<div class="title_left">
								<h3> </h3>
							</div>
						</div>

						<div class="clearfix"></div>

						<div class="row">
							
							<div class="col-md-12 col-sm-12 col-xs-12">
								<div class="x_panel">
									<div class="x_title">
										<h2 id="page">武器类型列表</h2>
										<ul class="nav navbar-right panel_toolbox">
											<li>
												<a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
											</li>
										</ul>
										<div class="clearfix"></div>
									</div>
									<div class="x_content">	
										
										<!--<div class="form-group">											
											<button type="button" id="delete" class="btn btn-danger">删除</button>																														
										</div>	-->
										
										<table id="datatable" class="table table-striped table-bordered">
					                      <thead>
					                        <tr>					                          	
												<th>武器种类</th>
												<th>是否启用</th>																																															
					                        </tr>
					                      </thead>
					
					
					                      <tbody>
					                                            
					                      </tbody>
					                   </table>																													
										
										<div class="ln_solid"></div>
										
										<form class="form-horizontal form-label-left">																						
											
											<div class="form-group">
												<label class="col-md-1 col-md-offset-4 control-label">武器种类</label>
												<div class="col-md-3">
													<input type="text" tabindex="1" id="weapontype" maxlength="20" class="form-control" disabled="disabled" placeholder="武器名称" />
												</div>												
											</div>																																																														
											
											<div class="form-group">																						
												<label class="control-label col-md-offset-4 col-md-1 col-sm-3 col-xs-12">是否启用</label>
												<div class="col-md-3 col-sm-9 col-xs-12">
													<select id="isuse" class="select2_single form-control" tabindex="6" disabled="disabled">														
														<option value='1'>是</option>
														<option value='0'>否</option>
													</select>
												</div>
											</div>																																	
											
											<div class="form-group">
												<div class="col-md-5 col-md-offset-5">
													<button type="button" tabindex="10" id="add" class="btn btn-info">新增</button>
													<button type="button" tabindex="11" id="delete_data" class="btn btn-danger" disabled="disabled">删除</button>
													<button type="button" tabindex="12" id="save" class="btn btn-default" disabled="disabled">保存</button>
													<button type="reset" tabindex="13" id="reset_form" class="btn btn-dark">重置</button>
												</div>																															
											</div>
											
										</form>
										

									</div>
								</div>
							</div>							
							
						</div>
					</div>
				</div>
				<!-- /page content -->

				<!-- footer content -->
				<footer>
					<div class="pull-right">
						<a href="http://dean.swjtu.edu.cn/" target="_blank">西南交通大学官网</a>
					</div>
					<div class="clearfix"></div>
				</footer>
				<!-- /footer content -->
			</div>
		</div>

		<!-- jQuery -->
		<script src="./vendors/jquery/dist/jquery.min.js"></script>
		<!-- Bootstrap -->
		<script src="./vendors/bootstrap/dist/js/bootstrap.min.js"></script>
		<!-- FastClick -->
		<script src="vendors/fastclick/lib/fastclick.js"></script>
		
		<script src="vendors/moment/min/moment.min.js"></script>
		<script src="vendors/bootstrap-daterangepicker/daterangepicker.js"></script>
		<!-- NProgress -->
		<script src="vendors/nprogress/nprogress.js"></script>			
		<!-- Datatables -->
	    <script src="./vendors/datatables.net/js/jquery.dataTables.min.js"></script>
	    <script src="./vendors/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
	    
	    <script src="./build/js/custom.min.js"></script>
	    
	    <script src="./vendors/jszip/dist/jszip.min.js"></script>
		<script>
	      $(document).ready(function() {	        
		    var datatable;
	      });	      	     
	    </script>
		
		<script>												
			
			var id;
						
			var weapontype = document.getElementById('weapontype');
			var isuse = document.getElementById('isuse');		
			
			var add = document.getElementById('add');
			var save = document.getElementById('save');
			var delete_data = document.getElementById('delete_data')
			var reset_form = document.getElementById('reset_form');	
			
			var addOrSave = 0;  //0是添加，1是保存
			var trueOrFalse = 0; //0为true，1为false
			
			function changeState(state){				
				weapontype.disabled = state;
				isuse.disabled = state;									
			}
				
			add.addEventListener('click',function(){
				addOrSave = 0;
				add.disabled = true;
				save.disabled = false;
				delete_data.disabled = true;
								
				changeState(false);
				
			});
			
			save.addEventListener('click',function(){
				
				var request = '';
				
				if(addOrSave == 0){
					request = 'addTypeData';
				}else if(addOrSave == 1){
					request = 'changeTypeData'
				}
								
				$.post('./script/weapon_interface.php',
					{
						'request' : request,
						'id' : id,
						'weapontype' : weapontype.value,
						'isuse' : isuse.options[isuse.selectedIndex].value,											
					},
					function(data){
						data = JSON.parse(data);
						if(data.status == true){
							addOrSave = 0;
							location.reload();
						}
					}
				);				
			});
			delete_data.addEventListener('click',function(){
				var isDelete = window.confirm("确认删除吗？");
				if(isDelete == false){					
					return false;
				}
				$.post('./script/weapon_interface.php',
					{
						'id' : id,
						'request' : 'deleteTypeData'
					},
					function(data){
						data = JSON.parse(data);
						if(data.status == true){
							location.reload();				
						}
					}
				)
			});			
			reset_form.addEventListener('click',function(){
				addOrSave = 0;
				add.disabled = false;
				save.disabled = true;
				delete_data.disabled = true;
				
				changeState(true);
				
			});																																													
			
			$(document).ready(function(){
				dealData();	
				var username = localStorage.getItem('username');
				$('#username').text(username);
				$.post('./script/interface.php',{'request':'getRights','username':username},function(data){
					data = JSON.parse(data);
					if(data.status == true){
						try{
							if(data.data[0]){
								var i = 0;
								var Module = data.data[0].Module;
								var str = `<li>
											<a><i class="fa fa-desktop"></i> `+ Module +` <span class="fa fa-chevron-down"></span></a>
											<ul class="nav child_menu">`;
								while(data.data[i]){
									if(data.data[i].Module == Module){
										str = str + `<li class=`+data.data[i].W_name+`>
													<a href="`+data.data[i].W_name+`.html">`+data.data[i].rightName+`</a>
												</li>`;
									}else{
										str = str + `</ul>
										</li>`;									
										$('.side-menu').append(str);
										Module = data.data[i].Module;
										str = `<li>
											<a><i class="fa fa-desktop"></i> `+ Module +` <span class="fa fa-chevron-down"></span></a>
											<ul class="nav child_menu">`;
										str = str + `<li class=`+data.data[i].W_name+`>
													<a href="`+data.data[i].W_name+`.html">`+data.data[i].rightName+`</a>
												</li>`;
									}	
									i++;
								}
								str = str + `</ul>
										</li>`;
										$('.side-menu').append(str);
								$.getScript('build/js/custom.min.js');
								$.getScript('js/myClickFunction.js');
							}else{
								$.getScript('build/js/custom.min.js');
								$.getScript('js/myClickFunction.js');
							}
							
						}catch(e){

						}						
					}else{
						$.getScript('build/js/custom.min.js');
						$.getScript('js/myClickFunction.js');
					}
				});
			});
			
			function dealData(){
				$.post('./script/weapon_interface.php',
					{
						'request' : 'getAllTypeData'	
					},
					function(data){
						data = JSON.parse(data);
						if(data.status == true){							
							try{	
								datatable = $('#datatable').dataTable({
									data : data.data,
									columns : [
										{ data : 'type' },
										{ data : 'isuse' },										
									],
									select: true,
									rowId : 'id',
									tabIndex : -1								    
								});																							
							}catch(e){
								
							}
													
						}
					}
				)
			}														
			
			
			$('tbody').on('click','tr',function(){				
				id = $(this).attr("id");
				$.post('./script/weapon_interface.php',
					{
						request : 'getTypeDataDetail',
						id : id
					},
					function(data){
						data = JSON.parse(data);											
						weapontype.value = data.data[0].type;
						$('#isuse').val(data.data[0].isuse);						
												
						addOrSave = 1;
						add.disabled = true;
						delete_data.disabled = false;
						save.disabled = false;
												
						changeState(false);
												
					}
				)
			});								
			
		</script>

	</body>

</html>
